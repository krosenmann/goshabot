#+TITLE: Асинхронное программирование на примере бота для Discord
#+AUTHOR: Roman Zayrullin
#+EMAIL: krosenmann@gmail.com
#+STARTUP: showall
#+TAGS: DBOT(b) 

*   
  #+name main-import
  #+begin_src python 
  from setup import AUTH_TOKEN
  import discord
  import asyncio

  client = discord.Client()

  #+end_src
** TODO при запуске стрима на твиче\ютубе кидает уведомление на определенный текстовый канал :DBOT:
   name live on *
   game | title

   команда: !twitch name; !youtube name

** TODO на определенном канале запускать викторину с вопросами из текстового файла :DBOT:

   команда: !victory и !stop

** DONE рандомная шутка из башорга или ithappens                       :DBOT:
   CLOSED: [2017-07-24 Пн 11:55]
   :LOGBOOK:
   CLOCK: [2017-07-20 Чт 23:12]--[2017-07-21 Пт 12:53] => 13:41
   :END:

   команда: !bash; !it
   #+NAME bot-itself
   #+BEGIN_SRC python :tangle bash.py :return shuteika.content :noweb yes
     <<main-import>>
     import requests
     import re
     from setup import AUTH_TOKEN

     client = discord.Client()
     EBASHIM = 'http://bash.im/forweb/?u'
     DELIM = "<' + '/span><' + 'br>", "<' + 'br><' + 'small>"

     @client.event
     async def on_ready():
         print('Logged in as')
         print(client.user.name)
         print(client.user.id)
         print('---------')

     @client.event
     async def on_message(message):
         if message.content.startswith('!bash'):
             await client.send_typing(message.channel)
             await asyncio.sleep(3)
             shuteika = requests.request('GET', EBASHIM)
             shuteika = shuteika.content.decode('utf-8')
             shuteika = shuteika.replace("<' + 'br>", "\n")
             shuteika = shuteika.replace("<' + 'br />", "\n")
             shuteika = shuteika.replace("&quot;", "''")
             shuteika = shuteika.replace("&lt;", "'")
             shuteika = shuteika.replace("&gt;", "'")
             shuteika = re.sub(r'var[\w\W]*;\"\>', '', shuteika)
             shuteika = shuteika[:shuteika.index('<\' + \'/div>')]
             await client.send_message(message.channel, shuteika)

     client.run(AUTH_TOKEN)
   #+END_SRC

   #+RESULTS:
   : var borq='';
   : borq += '<' + 'div id="b_q"><' + 'a href="http://bash.im/quote/419317">#419317<' + '/a> <' + 'span id="b_q_h">[ 5034 ]<' + '/span><' + 'div id="b_q_t" style="padding: 1em 0;">tessa: а можно поинтересоваться, что там было?) место закончилось?)<' + 'br>solmer: он сказал - я сервер и нехочу ничего решать<' + 'br>solmer: я хочу пиу пиу.<' + '/div><' + 'small><' + 'a href="http://bash.im/" target="_blank" title="bash.im откроется в новом окне">Больше на bash.im!<' + '/a><' + '/small><' + '/div>';
   : document.write(borq);

** URGENTLY!!! рандомная картинка                                      :DBOT:
   DEADLINE: <2017-08-06 Вс> SCHEDULED: <2017-08-03 Чт>

   команды стоит создать по названиям сайтов или по тематикам 
   САЙТЫ: 9gag, рандом гугль пикча хз (откуда вообще лучше и легче будет выдергивать?)

** TODO Приветствовалки и оповещалки о новых петучах на серваке тоже норм. Именно оповещалка. :DBOT:
   Уведомление о смене роли, например, тоже подойдёт.

* Process
